{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { of } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./message.service\";\nimport * as i3 from \"./sharing-service\";\nimport * as i4 from \"./login.service\";\nimport * as i5 from \"./product.service\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"./product-sharing-service\";\n/**\n * Methods for cart functionality, including add and remove product\n */\nexport class ShoppingCartService {\n  constructor(http, messageService, sharingService, userService, productService, router, productSharingService) {\n    this.http = http;\n    this.messageService = messageService;\n    this.sharingService = sharingService;\n    this.userService = userService;\n    this.productService = productService;\n    this.router = router;\n    this.productSharingService = productSharingService;\n    this.shoppingCartUrl = 'http://localhost:8080/shoppingCart';\n    this.currQuantity = 0;\n    this.httpOptions = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      })\n    };\n  }\n  /**\n   * directs user to their cart\n   */\n  navigateToCart() {\n    this.router.navigateByUrl(\"/cart\");\n  }\n  /** GET cart from the server */\n  getCart(id) {\n    const url = `${this.shoppingCartUrl}/${id}`;\n    return this.http.get(url).pipe(tap(_ => this.log('fetch shopping cart')), catchError(this.handleError('getShoppingCartError')));\n  }\n  /**\n   * decreases product quantity in inventory by 1\n   * helper for addToCartMain()\n   *\n   * @param productUpdate\n   */\n  updateQuantityAdd(productUpdate) {\n    let id = productUpdate.id;\n    let name = productUpdate.name;\n    let price = productUpdate.price;\n    let quantity = productUpdate.quantity - 1;\n    let description = productUpdate.description;\n    productUpdate = {\n      id,\n      name,\n      price,\n      quantity,\n      description\n    };\n    this.productService.updateProduct(productUpdate).subscribe(product => productUpdate = product);\n  }\n  /**\n   * Add product to user's cart and direct them to their cart\n   *\n   * @param product\n   */\n  addToCartMain(product) {\n    this.currentUser = this.sharingService.getData();\n    if (this.currentUser != undefined) {\n      this.cart = this.currentUser.cart;\n      this.cart.push(product);\n      this.userService.updateUser(this.currentUser).subscribe(currentUser => this.currentUser = currentUser);\n      this.sharingService.setData(this.currentUser);\n      this.updateQuantityAdd(product);\n      this.navigateToCart();\n    }\n  }\n  /**\n   * returns length of cart\n   * @param cart\n   * @returns\n   */\n  getCartLength(cart) {\n    return cart.length;\n  }\n  /**\n   * Removes the product from the user's cart\n   *\n   * @param product\n   */\n  removeFromCart(product) {\n    this.currentUser = this.sharingService.getData();\n    let firstRemoval = this.productSharingService.getData()[1];\n    if (firstRemoval) {\n      this.currQuantity = this.productSharingService.getData()[0];\n    } else {\n      this.currQuantity++;\n    }\n    if (this.currentUser != undefined) {\n      this.cart = this.currentUser.cart;\n      length = this.getCartLength(this.cart);\n      this.updateCartQuantity(this.cart, product, this.currQuantity);\n      var i;\n      let foundType = false;\n      let foundProduct = false;\n      for (i = length - 1; i >= 0; i--) {\n        if (this.cart[i].name === product.name) {\n          if (!foundType) {\n            this.currQuantity = this.cart[i].quantity;\n            foundType = true;\n          }\n        }\n      }\n      for (i = length - 1; i >= 0; i--) {\n        if (product == this.cart[i] && !foundProduct) {\n          this.cart.splice(i, 1);\n          this.userService.updateUser(this.currentUser).subscribe(currentUser => this.currentUser = currentUser);\n          this.sharingService.setData(this.currentUser);\n          this.updateQuantityRemove(product, this.currQuantity);\n          foundProduct = true;\n        }\n      }\n    }\n  }\n  /**\n   * updates product with +1 quantity\n   * removeFromCart() helper\n   * @param productUpdate\n   * @param quantity\n   */\n  updateQuantityRemove(productUpdate, quantity) {\n    let id = productUpdate.id;\n    let name = productUpdate.name;\n    let price = productUpdate.price;\n    let description = productUpdate.description;\n    productUpdate = {\n      id,\n      name,\n      price,\n      quantity,\n      description\n    };\n    this.productService.updateProduct(productUpdate).subscribe(product => productUpdate = product);\n  }\n  /**\n   * increases the quantity of each product of the same name by 1\n   * @param cart\n   * @param product\n   */\n  updateCartQuantity(cart, product, quantity) {\n    let length = cart.length;\n    for (var i = length - 1; i >= 0; i--) {\n      if (product.name === cart[i].name) {\n        cart[i].quantity = quantity;\n        quantity++;\n      }\n    }\n  }\n  /**\n   * Handle Http operation that failed.\n   * Let the app continue.\n   *\n   * @param operation - name of the operation that failed\n   * @param result - optional value to return as the observable result\n   */\n  handleError(operation = 'operation', result) {\n    return error => {\n      // TODO: send the error to remote logging infrastructure\n      console.error(error); // log to console instead\n      // TODO: better job of transforming error for user consumption\n      this.log(`${operation} failed: ${error.message}`);\n      // Let the app keep running by returning an empty result.\n      return of(result);\n    };\n  }\n  /** Log a ProductService message with the MessageService */\n  log(message) {\n    this.messageService.add(`ShoppingCartService: ${message}`);\n  }\n}\nShoppingCartService.ɵfac = function ShoppingCartService_Factory(t) {\n  return new (t || ShoppingCartService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.MessageService), i0.ɵɵinject(i3.SharingService), i0.ɵɵinject(i4.LoginService), i0.ɵɵinject(i5.ProductService), i0.ɵɵinject(i6.Router), i0.ɵɵinject(i7.ProductSharingService));\n};\nShoppingCartService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ShoppingCartService,\n  factory: ShoppingCartService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["HttpHeaders","of","catchError","tap","ShoppingCartService","constructor","http","messageService","sharingService","userService","productService","router","productSharingService","headers","navigateToCart","navigateByUrl","getCart","id","url","shoppingCartUrl","get","pipe","_","log","handleError","updateQuantityAdd","productUpdate","name","price","quantity","description","updateProduct","subscribe","product","addToCartMain","currentUser","getData","undefined","cart","push","updateUser","setData","getCartLength","length","removeFromCart","firstRemoval","currQuantity","updateCartQuantity","i","foundType","foundProduct","splice","updateQuantityRemove","operation","result","error","console","message","add","factory","providedIn"],"sourceRoot":"","sources":["/Users/shimantobhowmik/Downloads/School 2-2/SWEN/frontend-final/team-project-2225-swen-261-03-g-team0/estore-ui/src/app/shopping-cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\n\nimport { Product } from './product';\nimport { ShoppingCart } from './shopping-cart';\nimport { Login } from './login';\nimport { LoginService } from './login.service';\nimport { ProductService } from './product.service';\nimport { Router } from '@angular/router';\nimport { ProductSharingService } from './product-sharing-service';     \nimport { MessageService } from './message.service';\nimport { SharingService } from './sharing-service';\n\n\n/**\n * Methods for cart functionality, including add and remove product\n */\n\n@Injectable({ providedIn: 'root' })\nexport class ShoppingCartService {\n\n  private shoppingCartUrl = 'http://localhost:8080/shoppingCart'; \n\n  currentUser: Login | undefined;\n  cart: Product[] | undefined;\n  currQuantity: number = 0;\n\n  httpOptions = {\n    headers: new HttpHeaders({ 'Content-Type': 'application/json' })\n  };\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private sharingService: SharingService,\n    private userService: LoginService,\n    private productService: ProductService,\n    private router: Router,\n    private productSharingService: ProductSharingService\n) { }\n\n  /**\n   * directs user to their cart\n   */\n navigateToCart(){\n  this.router.navigateByUrl(\"/cart\");\n}\n\n  /** GET cart from the server */\n  getCart(id : number): Observable<ShoppingCart> {\n\n    const url = `${this.shoppingCartUrl}/${id}`;\n\n    return this.http.get<ShoppingCart>(url)\n      .pipe(\n        tap(_ => this.log('fetch shopping cart')),\n        catchError(this.handleError<ShoppingCart>('getShoppingCartError'))\n      );\n  }\n\n  /**\n   * decreases product quantity in inventory by 1\n   * helper for addToCartMain()\n   * \n   * @param productUpdate \n   */\n  updateQuantityAdd (productUpdate: Product) {\n    let id = productUpdate.id;\n    let name = productUpdate.name;\n    let price = productUpdate.price;\n    let quantity = productUpdate.quantity - 1;\n    let description = productUpdate.description;\n    productUpdate = {id, name, price, quantity, description} as Product;\n    this.productService.updateProduct(productUpdate).subscribe(product => productUpdate = product);\n  }\n\n  /**\n   * Add product to user's cart and direct them to their cart\n   * \n   * @param product \n   */\n  addToCartMain(product: Product) {\n    this.currentUser = this.sharingService.getData();\n    if (this.currentUser != undefined) {\n      this.cart = this.currentUser.cart;\n      this.cart.push(product);\n      this.userService.updateUser(this.currentUser).subscribe(currentUser => this.currentUser = currentUser);\n      this.sharingService.setData(this.currentUser);\n      this.updateQuantityAdd(product);\n      this.navigateToCart();\n    }\n  }\n\n  /**\n   * returns length of cart\n   * @param cart \n   * @returns \n   */\n  getCartLength(cart: Product[]): number {\n    return cart.length;\n  }\n\n  /**\n   * Removes the product from the user's cart\n   * \n   * @param product\n   */\n   removeFromCart(product: Product) {\n     this.currentUser = this.sharingService.getData();\n     let firstRemoval = this.productSharingService.getData()[1];\n     if (firstRemoval) {\n      this.currQuantity = this.productSharingService.getData()[0];\n     }\n     else {\n       this.currQuantity++;\n     }\n     if (this.currentUser != undefined) {\n       this.cart = this.currentUser.cart;\n      length = this.getCartLength(this.cart);\n      this.updateCartQuantity(this.cart, product, this.currQuantity);\n      var i: number;\n      let foundType = false\n      let foundProduct = false;\n      \n      for (i = length - 1; i >= 0; i--) {\n        if (this.cart[i].name === product.name) {\n          if (!foundType) {\n            this.currQuantity = this.cart[i].quantity;\n            foundType = true;\n          }\n        }\n      }\n      \n      for (i = length - 1; i>= 0; i--) {\n        if (product == this.cart[i] && !foundProduct) {\n          this.cart.splice(i, 1);\n          this.userService.updateUser(this.currentUser).subscribe(currentUser => this.currentUser = currentUser);\n          this.sharingService.setData(this.currentUser);\n          this.updateQuantityRemove(product, this.currQuantity);\n          foundProduct = true;\n        }\n      }\n    }\n  }\n\n  /**\n   * updates product with +1 quantity\n   * removeFromCart() helper\n   * @param productUpdate \n   * @param quantity \n   */\n  updateQuantityRemove(productUpdate: Product, quantity: number) {\n    let id = productUpdate.id;\n    let name = productUpdate.name;\n    let price = productUpdate.price;\n    let description = productUpdate.description;\n    productUpdate = {id, name, price, quantity, description} as Product;\n    this.productService.updateProduct(productUpdate).subscribe(product => productUpdate = product);\n  }\n\n  /**\n   * increases the quantity of each product of the same name by 1\n   * @param cart \n   * @param product \n   */\n  updateCartQuantity(cart: Product[], product: Product, quantity: number) {\n    let length = cart.length;\n    for (var i = length - 1; i >= 0; i--){\n      if (product.name === cart[i].name) {\n        cart[i].quantity = quantity;\n        quantity++;\n      }\n    }\n  }\n\n  /**\n   * Handle Http operation that failed.\n   * Let the app continue.\n   *\n   * @param operation - name of the operation that failed\n   * @param result - optional value to return as the observable result\n   */\n  private handleError<T>(operation = 'operation', result?: T) {\n    return (error: any): Observable<T> => {\n\n      // TODO: send the error to remote logging infrastructure\n      console.error(error); // log to console instead\n\n      // TODO: better job of transforming error for user consumption\n      this.log(`${operation} failed: ${error.message}`);\n\n      // Let the app keep running by returning an empty result.\n      return of(result as T);\n    };\n  }\n\n  /** Log a ProductService message with the MessageService */\n  private log(message: string) {\n    this.messageService.add(`ShoppingCartService: ${message}`);\n  }\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}